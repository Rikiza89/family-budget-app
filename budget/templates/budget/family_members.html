{% extends 'budget/base.html' %}
{% load i18n %}
{% block title %}{% trans "å®¶æ—ãƒ¡ãƒ³ãƒãƒ¼" %} - {% trans "å®¶è¨ˆç°¿" %}{% endblock %}

{% block content %}
<div class="p-4">
    <h2 class="text-2xl font-bold mb-6">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ {% trans "å®¶æ—ãƒ¡ãƒ³ãƒãƒ¼" %}</h2>

    <!-- ç¾åœ¨ã®ãƒ¡ãƒ³ãƒãƒ¼ -->
    <div class="bg-white rounded-lg shadow p-4 mb-6">
        <h3 class="font-bold mb-3">{% trans "ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§" %}</h3>
        <div class="space-y-2">
            {% for m in members %}
            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div>
                    <p class="font-medium">{{ m.nickname }}</p>
                    <p class="text-sm text-gray-600">@{{ m.user.username }}</p>
                </div>
                {% if m.user == request.user %}
                <span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded">{% trans "ã‚ãªãŸ" %}</span>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- æ‹›å¾…ãƒªãƒ³ã‚¯ -->
    <div class="bg-white rounded-lg shadow p-4 mb-6">
        <div class="flex items-center justify-between mb-3">
            <h3 class="font-bold">{% trans "æ‹›å¾…ãƒªãƒ³ã‚¯" %}</h3>
            <a href="{% url 'create_invite' %}" class="text-blue-600 text-sm hover:underline">{% trans "æ–°è¦ä½œæˆ" %}</a>
        </div>

        {% if active_invites %}
        <div class="space-y-3">
            {% for invite in active_invites %}
            <div class="p-3 bg-blue-50 rounded-lg">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-xs text-gray-600">{% trans "æœ‰åŠ¹æœŸé™" %}: {{ invite.expires_at|date:"Y/m/d H:i" }}</span>
                    <button onclick="deleteInvite({{ invite.id }})" class="text-red-600 text-xs hover:underline">{% trans "å‰Šé™¤" %}</button>
                </div>
                <div class="flex items-center space-x-2">
                    <input type="text" readonly value="{{ request.scheme }}://{{ request.get_host }}/signup/?invite={{ invite.code }}" id="invite-{{ invite.id }}" class="flex-1 p-2 text-sm bg-white border rounded">
                    <button onclick="copyInvite('{{ invite.id }}')" class="bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700">
                        {% trans "ã‚³ãƒ”ãƒ¼" %}
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-gray-500 text-center py-4">{% trans "æ‹›å¾…ãƒªãƒ³ã‚¯ãŒã‚ã‚Šã¾ã›ã‚“" %}</p>
        {% endif %}
    </div>

    <a href="{% url 'settings' %}" class="block text-center text-gray-600 hover:underline">â† {% trans "è¨­å®šã«æˆ»ã‚‹" %}</a>
</div>
{% endblock %}

{% block extra_js %}
<script>
function copyInvite(id) {
    const input = document.getElementById('invite-' + id);
    input.select();
    document.execCommand('copy');
    alert('âœ“ ãƒªãƒ³ã‚¯ã‚’{% trans "ã‚³ãƒ”ãƒ¼" %}ã—ã¾ã—ãŸ');
}

function deleteInvite(id) {
    if (confirm('ã“ã®{% trans "æ‹›å¾…ãƒªãƒ³ã‚¯" %}ã‚’{% trans "å‰Šé™¤" %}ã—ã¾ã™ã‹ï¼Ÿ')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/family/invite/${id}/delete/`;

        const csrf = document.createElement('input');
        csrf.type = 'hidden';
        csrf.name = 'csrfmiddlewaretoken';
        csrf.value = '{{ csrf_token }}';
        form.appendChild(csrf);

        document.body.appendChild(form);
        form.submit();
    }
}
</script>
{% endblock %}